-- --------------------------------------------------------------------------------------
-- TRIGGER
CREATE OR REPLACE FUNCTION UPDATE_STOCK() RETURNS TRIGGER AS
$BODY$
BEGIN
			IF NEW.RETURNED <> false THEN
				UPDATE ITEM SET STOCK=STOCK+1 WHERE ID=OLD.ITEM;
			END IF;
           RETURN new;
END;
$BODY$
language plpgsql

CREATE TRIGGER updating_the_stocks
BEFORE UPDATE
ON PURCHASE
FOR EACH ROW
	EXECUTE PROCEDURE UPDATE_STOCK();